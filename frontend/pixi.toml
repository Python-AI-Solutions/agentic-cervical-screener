[project]
name = "agentic-cervical-screener-frontend"
version = "0.1.0"
description = "Frontend for Agentic Cervical Screener with VLM testing support"
authors = ["Python-AI-Solutions"]
channels = ["conda-forge"]
platforms = ["osx-arm64", "osx-64", "linux-64"]

[dependencies]
# Node.js (includes npm)
nodejs = "20.*"

# Python for VLM testing
python = "3.12.*"
torchvision = ">=0.24.0,<0.25"

[target.osx-arm64.pypi-dependencies]
# MLX-VLM plugin - only on Apple Silicon
llm = "*"
llm-mlx-vlm = { path = "external/llm-mlx-vlm", editable = true }

[target.osx-64.pypi-dependencies]
# Intel Mac - use Ollama instead
llm = "*"
llm-ollama = "*"

[target.linux-64.pypi-dependencies]
# Linux - use Ollama
llm = "*"
llm-ollama = "*"

[tasks]
# npm passthrough tasks - use pixi's llm in PATH
install = "npm install"
dev = "npm run dev"
build = "npm run build"
preview = "npm run preview"

# Testing tasks - use 'llm' (available in pixi PATH)
test = { cmd = "npm test", env = { LLM_BIN = "llm" } }
test-unit = "npm run test:unit"
test-e2e = "npm run test:e2e"
test-vlm = { cmd = "npm run test:vlm", env = { LLM_BIN = "llm" } }
test-all = { cmd = "npm run test:all", env = { LLM_BIN = "llm" } }

# VLM-specific tasks (use 'llm' available in pixi PATH)
vlm-viewer = { cmd = "npm run vlm:viewer", env = { LLM_BIN = "llm" } }
vlm-docs = { cmd = "npm run vlm:docs", env = { LLM_BIN = "llm" } }

# Model management tasks
add-model = "bash scripts/add-vlm-model.sh $MODEL_NAME $HF_PATH"
download-model = "python -m mlx_vlm.download --model $HF_PATH"
test-model = "llm -m $MODEL_NAME 'What do you see?' -a playwright-artifacts/viewer/viewer-desktop-viewer-context.png"

# Setup task
setup = { cmd = "npm install", depends-on = ["install-vlm-plugin"] }
install-vlm-plugin = "echo 'VLM plugin installed via pypi-dependencies'"

# Playwright browser installation
install-browsers = "npx playwright install chromium"

# Direct llm command (for testing)
llm-test = "llm -m SmolVLM-500M 'test'"
